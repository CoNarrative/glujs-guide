<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">/*
 * Copyright (C) 2012 by CoNarrative
 */
<span id='glu-extjs-adapters-field'>/**
</span> * @class glu.extjs.adapters.field
 * @author Mike Gai
 * @extends glu.extjs.adapters.component
 * Base adapter for all of the various field types
 */
glu.regAdapter('field', {
    extend:'component',
    applyConventions:function (config, viewmodel) {
        Ext.applyIf(config, {
            value:glu.conventions.expression(config.name),
            valid:glu.conventions.expression(config.name + 'IsValid', {optional:true}),
            fieldLabel:glu.conventions.asLocaleKey(config.name)
        });
        glu.provider.adapters.Component.prototype.applyConventions.apply(this, arguments);
    },
<span id='glu-extjs-adapters-field-cfg-value'>    /**
</span>     * @cfg {String/Number} value
     *
     * *Two-way binding*. The value of this field.
     *
     * **Convention: ** @{*firstName*}
     */

<span id='glu-extjs-adapters-field-cfg-fieldLabel'>    /**
</span>     * @cfg {String} fieldLabel
     *
     * The label that will be applied to this field if in the appropriate layout.
     *
     * Usually, it is best to make sure that this is a localization key and not an exact text literal
     *      fieldLabel: '~~firstName~~'
     * will look up the key 'firstName' in the localizer and replace with the appropriate text
     *
     * **Convention: ** &amp;#126;&amp;#126;*firstName*&amp;#126;&amp;#126;
     */

<span id='glu-extjs-adapters-field-cfg-valid'>    /**
</span>     * @cfg {Boolean/String} valid
     * *One-way binding*
     * Updates the validity marking of the field.
     * The view model property can be either a boolean true/false
     * or a string (empty for valid, anything else will be the error message)
     *
     * **Convention:** @{*foo*IsValid}
     */
    validBindings:{
        setComponentProperty:function (newValue, oldValue, options, control) {
            var text = control.invalidText;
            if (Ext.isString(newValue)) {
                text = newValue;
                newValue = newValue === '' ? true : false;
            }
            if (newValue == false) {
                control.valid = false;
                control.markInvalid(text);
            } else {
                control.valid = true;
                control.clearInvalid();
            }
        },
        onInit:function (binding, control) {
            //DISABLE INTERNAL VALIDATION ON THIS CONTROL!
            control.validate = Ext.emptyFn;
            //initialize with proper valid markings--must be done AFTER RENDER...
            var me = this;
            control.on('render', function () {
                //AND after it has REALLY rendered
                setTimeout(function () {
                    glu.provider.adapters.field.validBindings.setComponentProperty(control.valid, false, {}, control);
                }, 1);
            });
        }
    },

    valueBindings:{
        eventName:'change',
        eventConverter:function (field, newVal) {
            return field.getValue()
        }
    }
});</pre>
</body>
</html>
